import filter.*

set "accessPolicy"
deny-unless-permit

policy "all authenticated users may see patient list"
permit action.java.name == "getPatients" & resource.http.requestedURI == "/patients"
where
 subject.authenticated == true;
transform "test"

policy "doctors may create new patients"
permit action == "accessCreationButton" & resource == "ui:view:patients"
where
 "DOCTOR" in subject..authority;

policy "filter patient data"
permit action.java.shortSig == "SecurePatientRepository.findById(..)"
obligation  
   { "type" : "sendEmail",
     "recipient" : "supervisor@example.org",
     "subject" : "Patient data has been accessed",
     "message" : subject.name + " has accessed patient data."
   }  
transform resource  |- { @.diagnosis: blacken(1,0,"\u2588") }

//policy "admins may do everything"
//permit "ADMIN" in subject..authority
 